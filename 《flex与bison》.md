# flex与bison简介
任何应用程序，只要它在其输入中寻找特点的模式，或者它使用命令语言作为输入，都适合使用flex和bison。

## 正则表达式与词法分析器
词法分析器通常所做的就是在输入中寻找字符串的模式(pattern)。flex程序主要由一系列带有指令的正则表达式组成，这些指令确定了正则表达式匹配后相应的动作(action)。由flex生成的词法分析器可以读取输入，匹配输入与所有的正则表达式并且执行每次匹配后适当的关联动作。

flex程序包含三个部分，各部分之间仅有%%的行进行分割。
1. 第一部分包含声明和选项设置
2. 第二部分是一系列的模式和动作
3. 第三部分是会拷贝到生成的**词法分析器**里面的C代码，通常是一些列与动作代码相关的例程。

大多数包含flex词法分析器的程序使用**词法**分析器来获得一个记号流，这样可以方便**语法**分析器的处理。

当程序需要一个记号时，它调用yylex()来读取一小部分输入然后返回相应的记号。

在词法分析器中，当动作代码识别出一个记号时，yylex()将以这个记号作为返回值。当程序再次调用yylex()时，词法分析器会以后续的输入字符继续分析。

当flex词法分析器返回一个记号流时, 每个记号实际上有两个组成部分，**记号编号(token number)**和**记号值(token's value)**。

记号编号是一个较小的整数。这个数字是随机确定的，但是**零值总是意味着文件的结束**。

当bison创建一个语法分析器时，bison自动地从258(避免与文字字符记号产生冲突)起指派每个记号编号，并且创建一个包含这些编号定义的.h文件。

**yylval**这个变量用来存储记号值，(记号值通常被定义为联合类型以便于不同类型的记号可以拥有不同类型的记号值)

## 文法与语法分析
语法分析器的任务是找出输入记号之间的关系。一种常见的关系表达方式是语法分析树(parse tree)。

bison语法分析器在分析其输入时都会构造一颗语法分析树。语法分析树只是隐式地包含在语法分析器进行的一些列操作中。有的应用程序中，它把整棵树作为一个数据结构创建在内存中以便于后续使用。

需要一定的方法来描述规则，语法分析器所使用的把一系列记号转化为语法分析树的规则。

计算机分析程序里最常用的语言就是上下文无关文法(CFG)，书写上下文无关文法的标准格式是BNF。bison的规则基本上就是BNF。

bison会自动帮你分析语法，记住每条被匹配的规则，所以动作代码只需要维护每个语法符号关联的语义值。

每个bison规则中的语法符号都有一个语义值，**目标符号**(冒号左边的语法符号)的值在动作中用代码$$代替，冒号右边语法符号的语义值依次为$1、$2，直到这条规则的结束。

当词法分析器返回记号时，记号值总是存储在yyval里，其他语法符号的语义值则在语法分析器的规则里进行设置。

# Flex词法分析器
任何flex词法分析器都使用了强大的正则表达式语言。正则表达式使用元语言来描述你想匹配的模式。
## 正则表达式
.
[]              字符类，可以匹配方括号中的任意一个字符。
[a-z]{-}[jv]
^               如果它是正则表达式的第一个字符就匹配行首。
$               如果它是正则表达式的最后一个字符就匹配行尾。
{}              当花括号中带有一个或两个数字时，它表示前一个模式可以匹配的最小和最大次数。例如：A{1,3}匹配一到三个字母A, 0{5}匹配00000。
\               用来表示元字符自身和一部分常用的C语言转义序列。
*               匹配0个或者多个紧接在前面的表达式。
+               匹配1个或者多个紧接在前面的表达式。
?               匹配0个或者1个紧接在前面的表达式。例如，-?[0-9]+
|               选择操作符，匹配紧接在前面的表达式或者紧跟在后面的表达式。
"..."           所有引号中的字符将基于字面意义被解释。
()              把一系列的正则表达式组成一个新的正则表达式。a(bc|de)匹配abc或者ade
/               尾部上下文，匹配斜线前的正则表达式，但是要求其后紧跟着斜线后的表达式。例如，0/1匹配字符串01中的0，但是不会匹配字符串0或者02。
## 二义性
flex通过两个简单的规则来解决二义性：
1. 词法分析器匹配输入时匹配**尽可能多**的字符串。
2. 如果两个模式都可以匹配的话，匹配在程序中**更早出现**的模式。

## Flex词法分析器中的文件I/O操作
### 输入
除非你另做安排，否则词法分析器**总是通过名为yyin的文件句柄读取输入。**否则，yyin将保持未赋值的状态，这种情况下，yylex会自动把stdin赋给它。

一般只需要在第一次调用yylex之前重新设定yyin。

flex提供了yyrestart(FILE* f)它使用词法分析器读取标准输入输出文件f。(可读取多个文件)


flex的输入管理的三个层次是：
1. 设置yyin来读取所需文件
2. 创建并使用YY_BUFFER_STATE输入缓冲区
3. 重定义YY_INPUT

### 输出
出发另行设定，否则flex总会执行一条默认的规则：所有没有被匹配的输入都拷贝到yyout。

## 起始状态和嵌套输入文件

## 符号表和重要语汇索引生成器

# Bison语法分析器

# 分析SQL解析

# 二义性和冲突

# 错误报告和恢复